{% extends "layout/base.html" %}

{% block content %}
<div class="container mt-5" style="max-width: 500px;">
  <h3 class="mb-4 text-center">Passwort ändern</h3>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="card">
    <div class="card-body">
      <form method="post">
        <div class="mb-3">
          <label for="altes_passwort" class="form-label">
            <i class="bi bi-lock"></i> Aktuelles Passwort
          </label>
          <input type="password" name="altes_passwort" id="altes_passwort" class="form-control" required autocomplete="current-password">
        </div>
        
        <hr class="my-4">
        
        <div class="mb-3">
          <label for="neues_passwort" class="form-label">
            <i class="bi bi-lock-fill"></i> Neues Passwort
          </label>
          <input type="password" name="neues_passwort" id="neues_passwort" class="form-control" required minlength="6" autocomplete="new-password">
          <small class="form-text text-muted">Mindestens 6 Zeichen</small>
        </div>
        
        <div class="mb-4">
          <label for="neues_passwort_wdh" class="form-label">
            <i class="bi bi-lock-fill"></i> Neues Passwort wiederholen
          </label>
          <input type="password" name="neues_passwort_wdh" id="neues_passwort_wdh" class="form-control" required minlength="6" autocomplete="new-password">
        </div>
        
        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-check-circle"></i> Passwort ändern
          </button>
          <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
            <i class="bi bi-x-circle"></i> Abbrechen
          </a>
        </div>
      </form>
    </div>
  </div>
  
  <div class="alert alert-info mt-4" role="alert">
    <i class="bi bi-info-circle"></i>
    <strong>Hinweis:</strong> Nach der Passwortänderung bleiben Sie angemeldet. Beim nächsten Login verwenden Sie das neue Passwort.
  </div>
</div>

<script>
  // Passwort-Übereinstimmung prüfen
  const neuesPasswort = document.getElementById('neues_passwort');
  const neuesPasswortWdh = document.getElementById('neues_passwort_wdh');
  
  neuesPasswortWdh.addEventListener('input', function() {
    if (neuesPasswort.value !== neuesPasswortWdh.value) {
      neuesPasswortWdh.setCustomValidity('Passwörter stimmen nicht überein');
    } else {
      neuesPasswortWdh.setCustomValidity('');
    }
  });
</script>
{% endblock %}

