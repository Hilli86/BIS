{% extends "layout/base.html" %}

{% block content %}
<style>
    .sortable-header a {
        cursor: pointer;
        user-select: none;
    }
    .sortable-header a:hover {
        color: var(--bs-primary) !important;
    }
    .sortable-header a i {
        font-size: 0.8em;
        opacity: 0.7;
    }
    
    /* Alle Tabellenzellen vertikal zentrieren f√ºr einheitliche Zeilenh√∂he */
    .table tbody td,
    .table thead th {
        vertical-align: middle;
    }
    
    /* Erste Spalte (Artikelnummer) - verhindert Umbruch */
    .table tbody td:first-child,
    .table thead th:first-child {
        white-space: nowrap;
        min-width: 100px;
    }
    
    /* Sicherstellen, dass Badge und Zahl nebeneinander bleiben ohne Flex */
    .table tbody td:first-child {
        line-height: 1.5;
    }
    
    /* Badge und Link inline nebeneinander */
    .table tbody td:first-child .badge,
    .table tbody td:first-child a {
        display: inline-block;
        vertical-align: middle;
    }
    
    /* Bei sehr kleinen Bildschirmen: Spalte etwas schmaler, aber immer noch ohne Umbruch */
    @media (max-width: 576px) {
        .table tbody td:first-child,
        .table thead th:first-child {
            min-width: 80px;
        }
    }
</style>

<h1 class="mb-4">üîß Ersatzteile</h1>

{% if 'admin' in session.get('user_berechtigungen', []) %}
<div class="mb-3">
    <a href="{{ url_for('ersatzteile.ersatzteil_neu') }}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Neues Ersatzteil
    </a>
</div>
{% endif %}

<!-- Filter -->
<div class="card mb-4 shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center" style="cursor: pointer;" data-bs-toggle="collapse" data-bs-target="#filterCollapse" aria-expanded="false" aria-controls="filterCollapse">
        <strong>Filter</strong>
        <span class="btn btn-sm btn-outline-primary">
            Anzeigen / Ausblenden
        </span>
    </div>
    <div class="collapse" id="filterCollapse">
        <div class="card-body">
            <form method="get" id="filterForm">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Kategorie</label>
                        <select name="kategorie" class="form-select">
                            <option value="">-- Alle Kategorien --</option>
                            {% for k in kategorien %}
                            <option value="{{ k.ID }}" {% if k.ID|string == kategorie_filter %}selected{% endif %}>{{ k.Bezeichnung }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Lieferant</label>
                        <select name="lieferant" class="form-select">
                            <option value="">-- Alle Lieferanten --</option>
                            {% for l in lieferanten %}
                            <option value="{{ l.ID }}" {% if l.ID|string == lieferant_filter %}selected{% endif %}>{{ l.Name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Textsuche</label>
                        <input type="text" name="q" class="form-control" value="{{ q_filter or '' }}" placeholder="Bestellnummer, Bezeichnung...">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Lagerort</label>
                        <select name="lagerort" class="form-select">
                            <option value="">-- Alle Lagerorte --</option>
                            {% for lo in lagerorte %}
                            <option value="{{ lo.ID }}" {% if lo.ID|string == lagerort_filter %}selected{% endif %}>{{ lo.Bezeichnung }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Lagerplatz</label>
                        <select name="lagerplatz" class="form-select">
                            <option value="">-- Alle Lagerpl√§tze --</option>
                            {% for lp in lagerplaetze %}
                            <option value="{{ lp.ID }}" {% if lp.ID|string == lagerplatz_filter %}selected{% endif %}>{{ lp.Bezeichnung }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Kennzeichen</label>
                        <select name="kennzeichen" class="form-select">
                            <option value="">-- Alle Kennzeichen --</option>
                            {% for kz in kennzeichen_liste %}
                            <option value="{{ kz.Kennzeichen }}" {% if kz.Kennzeichen == kennzeichen_filter %}selected{% endif %}>{{ kz.Kennzeichen }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-12">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="bestandswarnung" value="1" id="bestandswarnung" {% if bestandswarnung %}checked{% endif %}>
                            <label class="form-check-label" for="bestandswarnung">
                                Nur Bestandswarnungen anzeigen
                            </label>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <button type="submit" class="btn btn-primary">Filter anwenden</button>
                        <a href="{{ url_for('ersatzteile.ersatzteil_liste') }}" class="btn btn-secondary">Zur√ºcksetzen</a>
                        <input type="hidden" name="sort" value="{{ sort_by }}">
                        <input type="hidden" name="dir" value="{{ sort_dir }}">
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Ersatzteil-Liste -->
<div class="card shadow-sm">
    <div class="card-body">
        {% if ersatzteile %}
        <!-- Desktop-Version: Tabelle (nur auf md+ sichtbar) -->
        <div class="table-responsive d-none d-md-block">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th class="sortable-header">
                            <a href="{{ url_for('ersatzteile.ersatzteil_liste', sort='id', dir='asc' if sort_by != 'id' or sort_dir == 'desc' else 'desc', kategorie=kategorie_filter or '', lieferant=lieferant_filter or '', lagerort=lagerort_filter or '', lagerplatz=lagerplatz_filter or '', q=q_filter or '', bestandswarnung=1 if bestandswarnung else '', kennzeichen=kennzeichen_filter or '') }}" 
                               class="text-decoration-none text-dark d-flex align-items-center gap-1">
                                Art.Nr.
                                {% if sort_by == 'id' %}
                                    {% if sort_dir == 'asc' %}<i class="bi bi-arrow-up"></i>{% else %}<i class="bi bi-arrow-down"></i>{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th class="sortable-header">
                            <a href="{{ url_for('ersatzteile.ersatzteil_liste', sort='kategorie', dir='asc' if sort_by != 'kategorie' or sort_dir == 'desc' else 'desc', kategorie=kategorie_filter or '', lieferant=lieferant_filter or '', lagerort=lagerort_filter or '', lagerplatz=lagerplatz_filter or '', q=q_filter or '', bestandswarnung=1 if bestandswarnung else '', kennzeichen=kennzeichen_filter or '') }}" 
                               class="text-decoration-none text-dark d-flex align-items-center gap-1">
                                Kategorie
                                {% if sort_by == 'kategorie' %}
                                    {% if sort_dir == 'asc' %}<i class="bi bi-arrow-up"></i>{% else %}<i class="bi bi-arrow-down"></i>{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th class="sortable-header">
                            <a href="{{ url_for('ersatzteile.ersatzteil_liste', sort='bezeichnung', dir='asc' if sort_by != 'bezeichnung' or sort_dir == 'desc' else 'desc', kategorie=kategorie_filter or '', lieferant=lieferant_filter or '', lagerort=lagerort_filter or '', lagerplatz=lagerplatz_filter or '', q=q_filter or '', bestandswarnung=1 if bestandswarnung else '', kennzeichen=kennzeichen_filter or '') }}" 
                               class="text-decoration-none text-dark d-flex align-items-center gap-1">
                                Bezeichnung
                                {% if sort_by == 'bezeichnung' %}
                                    {% if sort_dir == 'asc' %}<i class="bi bi-arrow-up"></i>{% else %}<i class="bi bi-arrow-down"></i>{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th class="sortable-header">
                            <a href="{{ url_for('ersatzteile.ersatzteil_liste', sort='lieferant', dir='asc' if sort_by != 'lieferant' or sort_dir == 'desc' else 'desc', kategorie=kategorie_filter or '', lieferant=lieferant_filter or '', lagerort=lagerort_filter or '', lagerplatz=lagerplatz_filter or '', q=q_filter or '', bestandswarnung=1 if bestandswarnung else '', kennzeichen=kennzeichen_filter or '') }}" 
                               class="text-decoration-none text-dark d-flex align-items-center gap-1">
                                Lieferant
                                {% if sort_by == 'lieferant' %}
                                    {% if sort_dir == 'asc' %}<i class="bi bi-arrow-up"></i>{% else %}<i class="bi bi-arrow-down"></i>{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th class="sortable-header">
                            <a href="{{ url_for('ersatzteile.ersatzteil_liste', sort='artikelnummer', dir='asc' if sort_by != 'artikelnummer' or sort_dir == 'desc' else 'desc', kategorie=kategorie_filter or '', lieferant=lieferant_filter or '', lagerort=lagerort_filter or '', lagerplatz=lagerplatz_filter or '', q=q_filter or '', bestandswarnung=1 if bestandswarnung else '', kennzeichen=kennzeichen_filter or '') }}" 
                               class="text-decoration-none text-dark d-flex align-items-center gap-1">
                                Bestellnummer
                                {% if sort_by == 'artikelnummer' %}
                                    {% if sort_dir == 'asc' %}<i class="bi bi-arrow-up"></i>{% else %}<i class="bi bi-arrow-down"></i>{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th class="sortable-header">
                            <a href="{{ url_for('ersatzteile.ersatzteil_liste', sort='bestand', dir='asc' if sort_by != 'bestand' or sort_dir == 'desc' else 'desc', kategorie=kategorie_filter or '', lieferant=lieferant_filter or '', lagerort=lagerort_filter or '', lagerplatz=lagerplatz_filter or '', q=q_filter or '', bestandswarnung=1 if bestandswarnung else '', kennzeichen=kennzeichen_filter or '') }}" 
                               class="text-decoration-none text-dark d-flex align-items-center gap-1">
                                Bestand
                                {% if sort_by == 'bestand' %}
                                    {% if sort_dir == 'asc' %}<i class="bi bi-arrow-up"></i>{% else %}<i class="bi bi-arrow-down"></i>{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th class="sortable-header">
                            <a href="{{ url_for('ersatzteile.ersatzteil_liste', sort='lagerort', dir='asc' if sort_by != 'lagerort' or sort_dir == 'desc' else 'desc', kategorie=kategorie_filter or '', lieferant=lieferant_filter or '', lagerort=lagerort_filter or '', lagerplatz=lagerplatz_filter or '', q=q_filter or '', bestandswarnung=1 if bestandswarnung else '', kennzeichen=kennzeichen_filter or '') }}" 
                               class="text-decoration-none text-dark d-flex align-items-center gap-1">
                                Lagerort
                                {% if sort_by == 'lagerort' %}
                                    {% if sort_dir == 'asc' %}<i class="bi bi-arrow-up"></i>{% else %}<i class="bi bi-arrow-down"></i>{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        <th class="sortable-header">
                            <a href="{{ url_for('ersatzteile.ersatzteil_liste', sort='lagerplatz', dir='asc' if sort_by != 'lagerplatz' or sort_dir == 'desc' else 'desc', kategorie=kategorie_filter or '', lieferant=lieferant_filter or '', lagerort=lagerort_filter or '', lagerplatz=lagerplatz_filter or '', q=q_filter or '', bestandswarnung=1 if bestandswarnung else '', kennzeichen=kennzeichen_filter or '') }}" 
                               class="text-decoration-none text-dark d-flex align-items-center gap-1">
                                Lagerplatz
                                {% if sort_by == 'lagerplatz' %}
                                    {% if sort_dir == 'asc' %}<i class="bi bi-arrow-up"></i>{% else %}<i class="bi bi-arrow-down"></i>{% endif %}
                                {% endif %}
                            </a>
                        </th>
                        {% if is_admin %}
                        <th class="text-center">Sichtbare Abteilungen</th>
                        {% endif %}
                        <th>Aktionen</th>
                    </tr>
                </thead>
                <tbody>
                    {% for e in ersatzteile %}
                    <tr {% if not e.EndOfLife and e.Mindestbestand > 0 and e.AktuellerBestand < e.Mindestbestand %}class="table-warning"{% endif %} style="cursor: pointer;" onclick="window.location.href='{{ url_for('ersatzteile.ersatzteil_detail', ersatzteil_id=e.ID) }}';">
                        <td>
                            {% if e.Kennzeichen %}
                            <span class="badge bg-info me-1" style="width: 30px; display: inline-block; text-align: center;">{{ e.Kennzeichen }}</span>
                            {% else %}
                            <span class="badge me-1" style="width: 30px; display: inline-block; visibility: hidden;"></span>
                            {% endif %}
                            <a href="{{ url_for('ersatzteile.ersatzteil_detail', ersatzteil_id=e.ID) }}" class="text-decoration-none fw-bold" onclick="event.stopPropagation();">
                                {{ e.ID }}
                            </a>
                        </td>
                        <td><a href="{{ url_for('ersatzteile.ersatzteil_detail', ersatzteil_id=e.ID) }}" class="text-decoration-none text-dark">{{ e.Kategorie or '-' }}</a></td>
                        <td><a href="{{ url_for('ersatzteile.ersatzteil_detail', ersatzteil_id=e.ID) }}" class="text-decoration-none text-dark">{{ e.Bezeichnung }}</a></td>
                        <td><a href="{{ url_for('ersatzteile.ersatzteil_detail', ersatzteil_id=e.ID) }}" class="text-decoration-none text-dark">{{ e.Lieferant or '-' }}</a></td>
                        <td><a href="{{ url_for('ersatzteile.ersatzteil_detail', ersatzteil_id=e.ID) }}" class="text-decoration-none text-dark">{{ e.Bestellnummer }}</a></td>
                        <td>
                            <span class="badge {% if not e.EndOfLife and e.Mindestbestand > 0 and e.AktuellerBestand < e.Mindestbestand %}bg-warning{% elif e.AktuellerBestand > 0 %}bg-success{% else %}bg-secondary{% endif %}">
                                {{ e.AktuellerBestand }} {{ e.Einheit }}
                            </span>
                            {% if e.Mindestbestand > 0 %}
                            <br><small class="text-muted">Min: {{ e.Mindestbestand }}</small>
                            {% endif %}
                        </td>
                        <td><a href="{{ url_for('ersatzteile.ersatzteil_detail', ersatzteil_id=e.ID) }}" class="text-decoration-none text-dark">{{ e.LagerortName or '-' }}</a></td>
                        <td><a href="{{ url_for('ersatzteile.ersatzteil_detail', ersatzteil_id=e.ID) }}" class="text-decoration-none text-dark">{{ e.LagerplatzName or '-' }}</a></td>
                        {% if is_admin %}
                        <td class="text-center">
                            <span class="badge bg-info">{{ e.AbteilungenAnzahl or 0 }}</span>
                        </td>
                        {% endif %}
                        <td onclick="event.stopPropagation();">
                            <div class="btn-group" role="group">
                                <a href="{{ url_for('ersatzteile.ersatzteil_bearbeiten', ersatzteil_id=e.ID, next=url_for('ersatzteile.ersatzteil_liste', kategorie=kategorie_filter or '', lieferant=lieferant_filter or '', lagerort=lagerort_filter or '', lagerplatz=lagerplatz_filter or '', q=q_filter or '', sort=sort_by, dir=sort_dir, bestandswarnung=1 if bestandswarnung else '', kennzeichen=kennzeichen_filter or '')) }}" class="btn btn-sm btn-outline-warning" title="Artikel bearbeiten">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                {% if e.LieferantID %}
                                <button type="button" class="btn btn-sm btn-outline-success" onclick="addToAngebotsanfrage({{ e.ID }}, event)" title="Zu Angebotsanfrage hinzuf√ºgen">
                                    <i class="bi bi-cart-plus"></i>
                                </button>
                                {% endif %}
                                {% if default_printer and default_label %}
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="druckeEtikett({{ e.ID }}, event)" title="30x30-Etikett drucken">
                                    <i class="bi bi-printer"></i>
                                </button>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Mobile-Version: Cards (nur auf sm und kleiner sichtbar) -->
        <div class="d-md-none">
            {% for e in ersatzteile %}
            <div class="card mb-3 {% if not e.EndOfLife and e.Mindestbestand > 0 and e.AktuellerBestand < e.Mindestbestand %}border-warning{% endif %}" style="cursor: pointer;" onclick="window.location.href='{{ url_for('ersatzteile.ersatzteil_detail', ersatzteil_id=e.ID) }}';">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <div class="mb-1">
                                {% if e.Kennzeichen %}
                                <span class="badge bg-info me-1">{{ e.Kennzeichen }}</span>
                                {% endif %}
                                <strong>Art.Nr.:</strong> 
                                <a href="{{ url_for('ersatzteile.ersatzteil_detail', ersatzteil_id=e.ID) }}" class="text-decoration-none fw-bold" onclick="event.stopPropagation();">
                                    {{ e.ID }}
                                </a>
                            </div>
                            <div class="mb-1">
                                <strong>Bezeichnung:</strong> {{ e.Bezeichnung }}
                            </div>
                        </div>
                        <span class="badge {% if not e.EndOfLife and e.Mindestbestand > 0 and e.AktuellerBestand < e.Mindestbestand %}bg-warning{% elif e.AktuellerBestand > 0 %}bg-success{% else %}bg-secondary{% endif %}">
                            {{ e.AktuellerBestand }} {{ e.Einheit }}
                        </span>
                    </div>
                    
                    <div class="mb-2">
                        <strong>Kategorie:</strong> {{ e.Kategorie or '-' }}
                    </div>
                    
                    <div class="mb-2">
                        <strong>Lieferant:</strong> {{ e.Lieferant or '-' }}
                    </div>
                    
                    <div class="mb-2">
                        <strong>Bestellnummer:</strong> {{ e.Bestellnummer }}
                    </div>
                    
                    {% if e.Mindestbestand > 0 %}
                    <div class="mb-2">
                        <strong>Mindestbestand:</strong> {{ e.Mindestbestand }} {{ e.Einheit }}
                    </div>
                    {% endif %}
                    
                    <div class="mb-2">
                        <strong>Lagerort:</strong> {{ e.LagerortName or '-' }}
                    </div>
                    
                    <div class="mb-2">
                        <strong>Lagerplatz:</strong> {{ e.LagerplatzName or '-' }}
                    </div>
                    
                    {% if is_admin %}
                    <div class="mb-2">
                        <strong>Sichtbare Abteilungen:</strong> 
                        <span class="badge bg-info">{{ e.AbteilungenAnzahl or 0 }}</span>
                    </div>
                    {% endif %}
                    
                    <div class="mt-3" onclick="event.stopPropagation();">
                        <div class="btn-group w-100" role="group">
                            <a href="{{ url_for('ersatzteile.ersatzteil_bearbeiten', ersatzteil_id=e.ID, next=url_for('ersatzteile.ersatzteil_liste', kategorie=kategorie_filter or '', lieferant=lieferant_filter or '', lagerort=lagerort_filter or '', lagerplatz=lagerplatz_filter or '', q=q_filter or '', sort=sort_by, dir=sort_dir, bestandswarnung=1 if bestandswarnung else '', kennzeichen=kennzeichen_filter or '')) }}" class="btn btn-sm btn-outline-warning" title="Artikel bearbeiten">
                                <i class="bi bi-pencil"></i> Bearbeiten
                            </a>
                            {% if e.LieferantID %}
                            <button type="button" class="btn btn-sm btn-outline-success" onclick="addToAngebotsanfrage({{ e.ID }}, event)" title="Zu Angebotsanfrage hinzuf√ºgen">
                                <i class="bi bi-cart-plus"></i>
                            </button>
                            {% endif %}
                            {% if default_printer and default_label %}
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="druckeEtikett({{ e.ID }}, event)" title="30x30-Etikett drucken">
                                <i class="bi bi-printer"></i>
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> Keine Ersatzteile gefunden.
        </div>
        {% endif %}
    </div>
</div>

<script>
function addToAngebotsanfrage(ersatzteilId, event) {
    event.stopPropagation();
    
    // Button deaktivieren w√§hrend der Anfrage
    const button = event.target.closest('button');
    const originalContent = button.innerHTML;
    button.disabled = true;
    button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
    
    // AJAX-Anfrage
    fetch(`{{ url_for('ersatzteile.angebotsanfrage_smart_add', ersatzteil_id=0) }}`.replace('/0', `/${ersatzteilId}`))
        .then(response => response.json())
        .then(data => {
            button.disabled = false;
            button.innerHTML = originalContent;
            
            // Toast anzeigen
            const toastType = data.success ? 'success' : 'danger';
            const toastMessage = data.message || 'Unbekannter Fehler';
            
            showToast(toastMessage, toastType);
        })
        .catch(error => {
            button.disabled = false;
            button.innerHTML = originalContent;
            console.error('Fehler:', error);
            showToast('Fehler beim Hinzuf√ºgen zur Angebotsanfrage.', 'danger');
        });
}

function druckeEtikett(ersatzteilId, event) {
    event.stopPropagation();

    const button = event.target.closest('button');
    const originalContent = button.innerHTML;
    button.disabled = true;
    button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';

    fetch(`{{ url_for('ersatzteile.ersatzteil_druck_label', ersatzteil_id=0) }}`.replace('/0', `/${ersatzteilId}`), {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
        .then(response => response.json())
        .then(data => {
            button.disabled = false;
            button.innerHTML = originalContent;
            const toastType = data.success ? 'success' : 'danger';
            const toastMessage = data.message || 'Unbekannter Fehler beim Drucken.';
            showToast(toastMessage, toastType);
        })
        .catch(error => {
            button.disabled = false;
            button.innerHTML = originalContent;
            console.error('Fehler:', error);
            showToast('Fehler beim Drucken des Etiketts.', 'danger');
        });
}

function showToast(message, type = 'info') {
    // Toast-Container erstellen falls nicht vorhanden
    let toastContainer = document.getElementById('toastContainer');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toastContainer';
        toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
        toastContainer.style.zIndex = '9999';
        document.body.appendChild(toastContainer);
    }
    
    // Toast erstellen
    const toastId = 'toast-' + Date.now();
    const toastHtml = `
        <div id="${toastId}" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-${type === 'success' ? 'success' : type === 'danger' ? 'danger' : 'info'} text-white">
                <strong class="me-auto">
                    ${type === 'success' ? '‚úì Erfolg' : type === 'danger' ? '‚úó Fehler' : '‚Ñπ Info'}
                </strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                ${message}
            </div>
        </div>
    `;
    
    toastContainer.insertAdjacentHTML('beforeend', toastHtml);
    
    // Toast anzeigen
    const toastElement = document.getElementById(toastId);
    const toast = new bootstrap.Toast(toastElement, {
        autohide: true,
        delay: 5000
    });
    toast.show();
    
    // Toast nach dem Ausblenden entfernen
    toastElement.addEventListener('hidden.bs.toast', function() {
        toastElement.remove();
    });
}
</script>
{% endblock %}

